var nhoodMap=nhoodMap||{};!function(a){"use strict";function i(a){null!==a.getAnimation()?a.setAnimation(null):(a.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){a.setAnimation(null)},1400))}function o(a,i,o){var e=r.getProjection(),n=a.getPosition(),t=e.fromLatLngToContainerPixel(n),l=0,d=0;(t.x<i||t.x>$(document).width()||t.x<0)&&(l=t.x-i),(t.y<o||t.y>$(document).height()||t.y<0)&&(d=t.y-o),0===l&&0===d||s.panBy(l,d)}function e(){var a='<div class="iw-links"></div>';$(".iw-main").prepend(a),a+='<span class="iw-foursquare">Foursquare: </span>',a+='<span class="iw-foursquare-vis">hide</span>',$(".iw-links").append(a),$(".iw-foursquare-vis").on("click",function(a){"show"===a.target.innerHTML?($(".iw-foursquare-data").show(),a.target.innerHTML="hide"):($(".iw-foursquare-data").hide(),a.target.innerHTML="show")})}function n(i){var o=i.response.venue,e={name:o.name||a.mapManip.infoWindowMarker.title,phone:o.contact.formattedPhone||"None",category:o.categories[0].name||"None",imgUrl:o.bestPhoto.prefix+"100x100"+o.bestPhoto.suffix,address:o.location.formattedAddress||"None"},n='<div class="iw-foursquare-data">';n+='<div class="iw-header">',n+='<h3 class="iw-header-h3">'+e.name+"</h3></div>",n+='<div class="iw-data"><div class="iw-picture"><img src="'+e.imgUrl+'" ',n+='alt="Picture from foursquare"></div>',n+='<div class="iw-detail"><ul class="iw-detail-ul">',n+='<li class="iw-detail-li">Category: '+e.category+"</li>",n+='<li class="iw-detail-li">Phone: '+e.phone+"</li>",n+='<li class="iw-detail-li">Address: '+e.address+"</li>",n+="</ul></div></div></div>",$(".iw-main").append(n)}function t(a){var i;i="Yelp"===a?'<div class="iw-yelp-data">':'<div class="iw-foursquare-data">',i+="<p>Failed to retrieve data from "+a+"</p></div>",$(".iw-main").append(i)}a.mapManip=a.mapManip||{};var s,l,r;a.mapManip.initMap=function(){s=new google.maps.Map(document.getElementById("map"),{center:nhoodMap.model.centerLocation,zoom:14,disableDefaultUI:!0,zoomControl:!0,mapTypeControl:!0,mapTypeControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM,style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE]}}),r=new google.maps.OverlayView,r.draw=function(){},r.setMap(s),l=new google.maps.InfoWindow({content:"No data to display"}),a.mapManip.infoWindow=l;var i,o=new google.maps.LatLngBounds;nhoodMap.viewModel.ViewModel.placeList().forEach(function(e){e.marker=new google.maps.Marker({position:e.location,map:s,animation:google.maps.Animation.DROP,title:e.name()}),e.marker.addListener("click",function(){a.mapManip.getData(e)}),i=new google.maps.LatLng(e.location.lat,e.location.lng),o.extend(i)}),s.fitBounds(o)},a.mapManip.getData=function(r){var d=r.marker;a.mapManip.infoWindowMarker=d,$(document).width()<700?o(d,0,500):o(d,500,500),i(d);var p='<div class="iw-main"></div>';l.setContent(p),l.open(s,d),nhoodMap.model.foursquareRequest(r.name(),r.location,n,t),e()}}(nhoodMap);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcE1hbmlwLmpzIl0sIm5hbWVzIjpbIm5ob29kTWFwIiwiZSIsInRvZ2dsZUJvdW5jZSIsIm1hcmtlciIsImdldEFuaW1hdGlvbiIsInNldEFuaW1hdGlvbiIsImdvb2dsZSIsIm1hcHMiLCJBbmltYXRpb24iLCJCT1VOQ0UiLCJzZXRUaW1lb3V0Iiwic2hpZnRNYXAiLCJ4bWluIiwieW1pbiIsInByb2oiLCJvdmVybGF5IiwiZ2V0UHJvamVjdGlvbiIsInBvcyIsImdldFBvc2l0aW9uIiwicCIsImZyb21MYXRMbmdUb0NvbnRhaW5lclBpeGVsIiwieG9mZnNldCIsInlvZmZzZXQiLCJ4IiwiJCIsImRvY3VtZW50Iiwid2lkdGgiLCJ5IiwiaGVpZ2h0IiwibWFwIiwicGFuQnkiLCJkaXNwbGF5SW5mb1dpbmRvd0xpbmtzIiwiZm9ybWF0dGVkQ29udGVudCIsInByZXBlbmQiLCJhcHBlbmQiLCJvbiIsInRhcmdldCIsImlubmVySFRNTCIsInNob3ciLCJoaWRlIiwiZm91cnNxdWFyZVN1Y2Nlc3MiLCJkYXRhIiwidmVudWUiLCJyZXNwb25zZSIsImNvbnRlbnQiLCJuYW1lIiwibWFwTWFuaXAiLCJpbmZvV2luZG93TWFya2VyIiwidGl0bGUiLCJwaG9uZSIsImNvbnRhY3QiLCJmb3JtYXR0ZWRQaG9uZSIsImNhdGVnb3J5IiwiY2F0ZWdvcmllcyIsImltZ1VybCIsImJlc3RQaG90byIsInByZWZpeCIsInN1ZmZpeCIsImFkZHJlc3MiLCJsb2NhdGlvbiIsImZvcm1hdHRlZEFkZHJlc3MiLCJyZXF1ZXN0RmFpbGVkIiwiaW5mb1dpbmRvdyIsImluaXRNYXAiLCJNYXAiLCJnZXRFbGVtZW50QnlJZCIsImNlbnRlciIsIm1vZGVsIiwiY2VudGVyTG9jYXRpb24iLCJ6b29tIiwiZGlzYWJsZURlZmF1bHRVSSIsInpvb21Db250cm9sIiwibWFwVHlwZUNvbnRyb2wiLCJtYXBUeXBlQ29udHJvbE9wdGlvbnMiLCJwb3NpdGlvbiIsIkNvbnRyb2xQb3NpdGlvbiIsIkxFRlRfQk9UVE9NIiwic3R5bGUiLCJNYXBUeXBlQ29udHJvbFN0eWxlIiwiSE9SSVpPTlRBTF9CQVIiLCJtYXBUeXBlSWRzIiwiTWFwVHlwZUlkIiwiUk9BRE1BUCIsIlNBVEVMTElURSIsIk92ZXJsYXlWaWV3IiwiZHJhdyIsInNldE1hcCIsIkluZm9XaW5kb3ciLCJtYXJrZXJMYXRMbmciLCJib3VuZHMiLCJMYXRMbmdCb3VuZHMiLCJ2aWV3TW9kZWwiLCJWaWV3TW9kZWwiLCJwbGFjZUxpc3QiLCJmb3JFYWNoIiwicGxhY2UiLCJNYXJrZXIiLCJhbmltYXRpb24iLCJEUk9QIiwiYWRkTGlzdGVuZXIiLCJnZXREYXRhIiwiTGF0TG5nIiwibGF0IiwibG5nIiwiZXh0ZW5kIiwiZml0Qm91bmRzIiwic2V0Q29udGVudCIsIm9wZW4iLCJmb3Vyc3F1YXJlUmVxdWVzdCJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBSUEsVUFBV0EsY0FFZixTQUFVQyxHQUNSLFlBdUVBLFNBQVNDLEdBQWFDLEdBQ1UsT0FBMUJBLEVBQU9DLGVBQ1RELEVBQU9FLGFBQWEsT0FFcEJGLEVBQU9FLGFBQWFDLE9BQU9DLEtBQUtDLFVBQVVDLFFBQzFDQyxXQUFXLFdBQWFQLEVBQU9FLGFBQWEsT0FBVSxPQU0xRCxRQUFTTSxHQUFTUixFQUFRUyxFQUFNQyxHQUM5QixHQUFJQyxHQUFPQyxFQUFRQyxnQkFDZkMsRUFBTWQsRUFBT2UsY0FDYkMsRUFBSUwsRUFBS00sMkJBQTJCSCxHQUNwQ0ksRUFBVSxFQUNWQyxFQUFVLEdBR1ZILEVBQUVJLEVBQUlYLEdBQVFPLEVBQUVJLEVBQUlDLEVBQUVDLFVBQVVDLFNBQVdQLEVBQUVJLEVBQUksS0FBTUYsRUFBVUYsRUFBRUksRUFBSVgsSUFDdkVPLEVBQUVRLEVBQUlkLEdBQVFNLEVBQUVRLEVBQUlILEVBQUVDLFVBQVVHLFVBQVlULEVBQUVRLEVBQUksS0FBS0wsRUFBVUgsRUFBRVEsRUFBSWQsR0FDM0QsSUFBWlEsR0FBNkIsSUFBWkMsR0FBaUJPLEVBQUlDLE1BQU1ULEVBQVNDLEdBMkIzRCxRQUFTUyxLQUNQLEdBQUlDLEdBQW1CLDhCQUN2QlIsR0FBRSxZQUFZUyxRQUFRRCxHQUN0QkEsR0FBb0Isa0RBQ3BCQSxHQUFvQiw4Q0FDcEJSLEVBQUUsYUFBYVUsT0FBT0YsR0FDdEJSLEVBQUUsc0JBQXNCVyxHQUFHLFFBQVMsU0FBU2xDLEdBQ2hCLFNBQXZCQSxFQUFFbUMsT0FBT0MsV0FDWGIsRUFBRSx1QkFBdUJjLE9BQ3pCckMsRUFBRW1DLE9BQU9DLFVBQVksU0FFckJiLEVBQUUsdUJBQXVCZSxPQUN6QnRDLEVBQUVtQyxPQUFPQyxVQUFZLFVBTTNCLFFBQVNHLEdBQWtCQyxHQUN6QixHQUFJQyxHQUFRRCxFQUFLRSxTQUFTRCxNQUN0QkUsR0FDRkMsS0FBTUgsRUFBTUcsTUFBUTVDLEVBQUU2QyxTQUFTQyxpQkFBaUJDLE1BQ2hEQyxNQUFPUCxFQUFNUSxRQUFRQyxnQkFBa0IsT0FDdkNDLFNBQVVWLEVBQU1XLFdBQVcsR0FBR1IsTUFBUSxPQUN0Q1MsT0FBUVosRUFBTWEsVUFBVUMsT0FBUyxVQUFZZCxFQUFNYSxVQUFVRSxPQUM3REMsUUFBU2hCLEVBQU1pQixTQUFTQyxrQkFBb0IsUUFFMUM1QixFQUFtQixrQ0FDdkJBLElBQW9CLDBCQUNwQkEsR0FBb0IsNEJBQThCWSxFQUFRQyxLQUFPLGNBQ2pFYixHQUFvQiwwREFBNERZLEVBQVFVLE9BQVMsS0FDakd0QixHQUFvQix1Q0FDcEJBLEdBQW9CLG1EQUNwQkEsR0FBb0Isc0NBQXdDWSxFQUFRUSxTQUFXLFFBQy9FcEIsR0FBb0IsbUNBQXFDWSxFQUFRSyxNQUFRLFFBQ3pFakIsR0FBb0IscUNBQXVDWSxFQUFRYyxRQUFVLFFBQzdFMUIsR0FBb0IsMEJBQ3BCUixFQUFFLFlBQVlVLE9BQU9GLEdBS3ZCLFFBQVM2QixHQUFjcEIsR0FDckIsR0FBSVQsRUFFRkEsR0FEVyxTQUFUUyxFQUNpQiw2QkFFQSxtQ0FFckJULEdBQW9CLG1DQUFxQ1MsRUFBTyxhQUNoRWpCLEVBQUUsWUFBWVUsT0FBT0YsR0F4S3ZCL0IsRUFBRTZDLFNBQVc3QyxFQUFFNkMsWUFHZixJQUFJakIsR0FBS2lDLEVBQVkvQyxDQUdyQmQsR0FBRTZDLFNBQVNpQixRQUFVLFdBRW5CbEMsRUFBTSxHQUFJdkIsUUFBT0MsS0FBS3lELElBQUl2QyxTQUFTd0MsZUFBZSxRQUNoREMsT0FBUWxFLFNBQVNtRSxNQUFNQyxlQUN2QkMsS0FBTSxHQUNOQyxrQkFBa0IsRUFDbEJDLGFBQWEsRUFDYkMsZ0JBQWdCLEVBQ2hCQyx1QkFDRUMsU0FBVXBFLE9BQU9DLEtBQUtvRSxnQkFBZ0JDLFlBQ3RDQyxNQUFPdkUsT0FBT0MsS0FBS3VFLG9CQUFvQkMsZUFDdkNDLFlBQ0UxRSxPQUFPQyxLQUFLMEUsVUFBVUMsUUFFdEI1RSxPQUFPQyxLQUFLMEUsVUFBVUUsY0FPNUJwRSxFQUFVLEdBQUlULFFBQU9DLEtBQUs2RSxZQUMxQnJFLEVBQVFzRSxLQUFPLGFBQ2Z0RSxFQUFRdUUsT0FBT3pELEdBR2ZpQyxFQUFhLEdBQUl4RCxRQUFPQyxLQUFLZ0YsWUFDM0IzQyxRQUFTLHVCQUlYM0MsRUFBRTZDLFNBQVNnQixXQUFhQSxDQUl4QixJQUNJMEIsR0FEQUMsRUFBUyxHQUFJbkYsUUFBT0MsS0FBS21GLFlBSTdCMUYsVUFBUzJGLFVBQVVDLFVBQVVDLFlBQVlDLFFBQVEsU0FBU0MsR0FDeERBLEVBQU01RixPQUFTLEdBQUlHLFFBQU9DLEtBQUt5RixRQUM3QnRCLFNBQVVxQixFQUFNcEMsU0FDaEI5QixJQUFLQSxFQUNMb0UsVUFBVzNGLE9BQU9DLEtBQUtDLFVBQVUwRixLQUNqQ2xELE1BQU8rQyxFQUFNbEQsU0FJZmtELEVBQU01RixPQUFPZ0csWUFBWSxRQUFTLFdBQ2hDbEcsRUFBRTZDLFNBQVNzRCxRQUFRTCxLQUlyQlAsRUFBZSxHQUFJbEYsUUFBT0MsS0FBSzhGLE9BQU9OLEVBQU1wQyxTQUFTMkMsSUFBS1AsRUFBTXBDLFNBQVM0QyxLQUN6RWQsRUFBT2UsT0FBT2hCLEtBSWhCM0QsRUFBSTRFLFVBQVVoQixJQStCaEJ4RixFQUFFNkMsU0FBU3NELFFBQVUsU0FBU0wsR0FDNUIsR0FBSTVGLEdBQVM0RixFQUFNNUYsTUFHbkJGLEdBQUU2QyxTQUFTQyxpQkFBbUI1QyxFQUN6QnFCLEVBQUVDLFVBQVVDLFFBQVUsSUFFekJmLEVBQVNSLEVBQVEsRUFBRyxLQUdwQlEsRUFBU1IsRUFBUSxJQUFLLEtBRXhCRCxFQUFhQyxFQUViLElBQUk2QixHQUFtQiw2QkFDdkI4QixHQUFXNEMsV0FBVzFFLEdBQ3RCOEIsRUFBVzZDLEtBQUs5RSxFQUFLMUIsR0FFckJILFNBQVNtRSxNQUFNeUMsa0JBQWtCYixFQUFNbEQsT0FBUWtELEVBQU1wQyxTQUFVbkIsRUFBbUJxQixHQUNsRjlCLE1BeUREL0IiLCJmaWxlIjoibWFwTWFuaXAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIG5ob29kTWFwID0gbmhvb2RNYXAgfHwge307XG5cbihmdW5jdGlvbihlKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgZS5tYXBNYW5pcCA9IGUubWFwTWFuaXAgfHwge307XG5cbiAgLy8gTWFrZSB0aGVzZSB2YXJpYWJsZXMgYWNjZXNzaWJsZSBmcm9tIG91dHNpZGUgb2YgaW5pdE1hcFxuICB2YXIgbWFwLCBpbmZvV2luZG93LCBvdmVybGF5LCBib3VuZHM7XG5cbiAgLy8gQ3JlYXRlIGluaXRpYWwgbWFwXG4gIGUubWFwTWFuaXAuaW5pdE1hcCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICAgIGNlbnRlcjogbmhvb2RNYXAubW9kZWwuY2VudGVyTG9jYXRpb24sXG4gICAgICB6b29tOiAxNCwgLy8gTm90IHN0cmljdGx5IHJlcXVpcmVkIGFzIG1hcCB3aWxsIGJlIGZpdHRlZCB0byBtYXJrZXJzXG4gICAgICBkaXNhYmxlRGVmYXVsdFVJOiB0cnVlLFxuICAgICAgem9vbUNvbnRyb2w6IHRydWUsXG4gICAgICBtYXBUeXBlQ29udHJvbDogdHJ1ZSxcbiAgICAgIG1hcFR5cGVDb250cm9sT3B0aW9uczoge1xuICAgICAgICBwb3NpdGlvbjogZ29vZ2xlLm1hcHMuQ29udHJvbFBvc2l0aW9uLkxFRlRfQk9UVE9NLFxuICAgICAgICBzdHlsZTogZ29vZ2xlLm1hcHMuTWFwVHlwZUNvbnRyb2xTdHlsZS5IT1JJWk9OVEFMX0JBUixcbiAgICAgICAgbWFwVHlwZUlkczogW1xuICAgICAgICAgIGdvb2dsZS5tYXBzLk1hcFR5cGVJZC5ST0FETUFQLFxuICAgICAgICAgIC8vIGdvb2dsZS5tYXBzLk1hcFR5cGVJZC5URVJSQUlOLFxuICAgICAgICAgIGdvb2dsZS5tYXBzLk1hcFR5cGVJZC5TQVRFTExJVEVcbiAgICAgICAgXVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIGFuIG92ZXJsYXkgc28gdGhhdCB3ZSBjYW4gdXNlIGl0IGxhdGVyIHRvIGdldFxuICAgIC8vIHBpeGVsIGxvY2F0aW9ucyBvZiBtYXJrZXJzXG4gICAgb3ZlcmxheSA9IG5ldyBnb29nbGUubWFwcy5PdmVybGF5VmlldygpO1xuICAgIG92ZXJsYXkuZHJhdyA9IGZ1bmN0aW9uKCkge307XG4gICAgb3ZlcmxheS5zZXRNYXAobWFwKTtcblxuICAgIC8vIEp1c3QgY3JlYXRlIGEgc2luZ2xlIGluZm9XaW5kb3cgdGhhdCB3aWxsIGJlIHNoYXJlZCBieSBhbGwgbWFya2Vyc1xuICAgIGluZm9XaW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyh7XG4gICAgICBjb250ZW50OiAnTm8gZGF0YSB0byBkaXNwbGF5J1xuICAgIH0pO1xuXG4gICAgLy8gTWFrZSBpbmZvV2luZG93IGdsb2JhbGx5IGF2YWlsYWJsZSB0byBuaG9vZE1hcFxuICAgIGUubWFwTWFuaXAuaW5mb1dpbmRvdyA9IGluZm9XaW5kb3c7XG5cbiAgICAvLyBDcmVhdGUgYSBMYXRMbmdCb3VuZHMgb2JqZWN0IHRoYXQgY2FuIGJlIGV4dGVuZGVkIHdpdGggdGhlIGxvY2F0aW9uc1xuICAgIC8vIG9mIGFsbCBNYXJrZXJzXG4gICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcbiAgICB2YXIgbWFya2VyTGF0TG5nO1xuXG4gICAgLy8gQ3JlYXRlIGEgbWFya2VyIGZvciBlYWNoIHBsYWNlIGluIHRoZSBwbGFjZUxpc3RcbiAgICBuaG9vZE1hcC52aWV3TW9kZWwuVmlld01vZGVsLnBsYWNlTGlzdCgpLmZvckVhY2goZnVuY3Rpb24ocGxhY2UpIHtcbiAgICAgIHBsYWNlLm1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgICBwb3NpdGlvbjogcGxhY2UubG9jYXRpb24sXG4gICAgICAgIG1hcDogbWFwLFxuICAgICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QLFxuICAgICAgICB0aXRsZTogcGxhY2UubmFtZSgpXG4gICAgICB9KTtcblxuICAgICAgLy8gV2hlbiBtYXJrZXIgaXMgY2xpY2tlZCBydW4gYSBmdW5jdGlvbiB0byByZXRyaWV2ZSBkYXRhXG4gICAgICBwbGFjZS5tYXJrZXIuYWRkTGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGUubWFwTWFuaXAuZ2V0RGF0YShwbGFjZSk7XG4gICAgICB9KTtcblxuICAgICAgLy8gQ3JlYXRlIExhdExuZyBvYmplY3QgZnJvbSBwbGFjZSBwb3NpdGlvbiBhbmQgdXNlIGl0IHRvIGV4dGVuZCB0aGUgbWFwIGJvdW5kc1xuICAgICAgbWFya2VyTGF0TG5nID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhwbGFjZS5sb2NhdGlvbi5sYXQsIHBsYWNlLmxvY2F0aW9uLmxuZyk7XG4gICAgICBib3VuZHMuZXh0ZW5kKG1hcmtlckxhdExuZyk7XG4gICAgfSk7XG5cbiAgICAvLyBGaXQgdGhlIG1hcCB0byBzaG93IGFsbCBNYXJrZXJzXG4gICAgbWFwLmZpdEJvdW5kcyhib3VuZHMpO1xuICB9O1xuXG5cblxuICAvLyBCb3VuY2UgdGhlIG1hcmtlciBmb3IgYSBzaG9ydCBwZXJpb2RcbiAgZnVuY3Rpb24gdG9nZ2xlQm91bmNlKG1hcmtlcikge1xuICAgIGlmIChtYXJrZXIuZ2V0QW5pbWF0aW9uKCkgIT09IG51bGwpIHtcbiAgICAgIG1hcmtlci5zZXRBbmltYXRpb24obnVsbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1hcmtlci5zZXRBbmltYXRpb24oZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkJPVU5DRSk7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBtYXJrZXIuc2V0QW5pbWF0aW9uKG51bGwpOyB9LCAxNDAwKTtcbiAgICB9XG4gIH1cblxuICAvLyBTaGlmdCB0aGUgbWFwIHNvIHRoYXQgTWFya2VyIHggYW5kIHkgcGl4ZWwgcG9zaXRpb25cbiAgLy8gaXMgYSBtaW5pbXVtIG9mIHhtaW4gYW5kIHltaW5cbiAgZnVuY3Rpb24gc2hpZnRNYXAobWFya2VyLCB4bWluLCB5bWluKSB7XG4gICAgdmFyIHByb2ogPSBvdmVybGF5LmdldFByb2plY3Rpb24oKTtcbiAgICB2YXIgcG9zID0gbWFya2VyLmdldFBvc2l0aW9uKCk7XG4gICAgdmFyIHAgPSBwcm9qLmZyb21MYXRMbmdUb0NvbnRhaW5lclBpeGVsKHBvcyk7XG4gICAgdmFyIHhvZmZzZXQgPSAwO1xuICAgIHZhciB5b2Zmc2V0ID0gMDtcbiAgICAvLyBEb24ndCBtb3ZlIGlmIG5vdCBuZWNlc3NhcnkgYnV0IGRvIG1vdmUgaWYgTWFya2VyXG4gICAgLy8gaXMgbm90IGN1cnJlbnRseSBvbiBkaXNwbGF5ZWQgc2VjdGlvbiBvZiBtYXBcbiAgICBpZiAocC54IDwgeG1pbiB8fCBwLnggPiAkKGRvY3VtZW50KS53aWR0aCgpIHx8IHAueCA8IDAgKSB7IHhvZmZzZXQgPSBwLnggLSB4bWluOyB9XG4gICAgaWYgKHAueSA8IHltaW4gfHwgcC55ID4gJChkb2N1bWVudCkuaGVpZ2h0KCkgfHwgcC55IDwgMCkgeyB5b2Zmc2V0ID0gcC55IC0geW1pbjsgfVxuICAgIGlmICh4b2Zmc2V0ICE9PSAwIHx8IHlvZmZzZXQgIT09IDApIHsgbWFwLnBhbkJ5KHhvZmZzZXQsIHlvZmZzZXQpOyB9XG4gIH1cbiAgLy8gUmV0cmlldmUgZGF0YSBhYm91dCBNYXJrZXIgYW5kIGRpc3BsYXkgaW4gSW5mb1dpbmRvd1xuICAvLyBUaGlzIGZ1bmN0aW9uIG5lZWRzIGdsb2JhbCB2aXNpYmlsaXR5IGFzIGl0IGlzIGNhbGxlZCBmcm9tIHZpZXdNb2RlbCB0b29cbiAgZS5tYXBNYW5pcC5nZXREYXRhID0gZnVuY3Rpb24ocGxhY2UpIHtcbiAgICB2YXIgbWFya2VyID0gcGxhY2UubWFya2VyO1xuICAgIC8vIENyZWF0ZSBhIG5ob29kTWFwIGdsb2JhbCB2YXJpYWJsZSB0byByZWZlcmVuY2UgbWFya2VyXG4gICAgLy8gdGhhdCBpcyBjdXJyZW50bHkgYXNzb2NpYXRlZCB3aXRoIHRoZSBpbmZvV2luZG93XG4gICAgZS5tYXBNYW5pcC5pbmZvV2luZG93TWFya2VyID0gbWFya2VyO1xuICAgIGlmICggJChkb2N1bWVudCkud2lkdGgoKSA8IDcwMCApIHtcbiAgICAgIC8vIE9uIG5hcnJvdyBzY3JlZW5zIHNoaWZ0IHRoZSBtYXAgZG93biBzbyB0aGF0IHRvcCBvZiBJbmZvV2luZG93IGlzIGRpc3BsYXllZFxuICAgICAgc2hpZnRNYXAobWFya2VyLCAwLCA1MDApO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBPbiB3aWRlciBzY3JlZW5zIHNoaWZ0IHRoZSBtYXAgcmlnaHQgYXMgd2VsbCBzbyBJbmZvV2luZG93IGlzIGF3YXkgZnJvbSBwbGFjZSBsaXN0XG4gICAgICBzaGlmdE1hcChtYXJrZXIsIDUwMCwgNTAwKTtcbiAgICB9XG4gICAgdG9nZ2xlQm91bmNlKG1hcmtlcik7XG4gICAgLy8gQ3JlYXRlIGluaXRpYWwgY29udGVudCBmb3IgSW5mb1dpbmRvdyBhbmQgdGhlbiBvcGVuIHRoZSBJbmZvV2luZG93IGZvciB0aGUgTWFya2VyXG4gICAgdmFyIGZvcm1hdHRlZENvbnRlbnQgPSAnPGRpdiBjbGFzcz1cIml3LW1haW5cIj48L2Rpdj4nO1xuICAgIGluZm9XaW5kb3cuc2V0Q29udGVudChmb3JtYXR0ZWRDb250ZW50KTtcbiAgICBpbmZvV2luZG93Lm9wZW4obWFwLCBtYXJrZXIpO1xuICAgIC8vIGFyZSBoYW5kbGVkIGJ5IHRoZSB5ZWxwU3VjY2VzcyBhbmQgZm91cnNxdWFyZVN1Y2Nlc3MgY2FsbGJhY2sgZnVuY3Rpb25zXG4gICAgbmhvb2RNYXAubW9kZWwuZm91cnNxdWFyZVJlcXVlc3QocGxhY2UubmFtZSgpLCBwbGFjZS5sb2NhdGlvbiwgZm91cnNxdWFyZVN1Y2Nlc3MsIHJlcXVlc3RGYWlsZWQpO1xuICAgIGRpc3BsYXlJbmZvV2luZG93TGlua3MoKTtcbiAgfTtcblxuICAvLyBTaG93L0hpZGUgdGhlIGRhdGEgZnJvbSBGb3Vyc3F1YXJlXG4gIGZ1bmN0aW9uIGRpc3BsYXlJbmZvV2luZG93TGlua3MoKSB7XG4gICAgdmFyIGZvcm1hdHRlZENvbnRlbnQgPSAnPGRpdiBjbGFzcz1cIml3LWxpbmtzXCI+PC9kaXY+JztcbiAgICAkKFwiLml3LW1haW5cIikucHJlcGVuZChmb3JtYXR0ZWRDb250ZW50KTtcbiAgICBmb3JtYXR0ZWRDb250ZW50ICs9ICc8c3BhbiBjbGFzcz1cIml3LWZvdXJzcXVhcmVcIj5Gb3Vyc3F1YXJlOiA8L3NwYW4+JztcbiAgICBmb3JtYXR0ZWRDb250ZW50ICs9ICc8c3BhbiBjbGFzcz1cIml3LWZvdXJzcXVhcmUtdmlzXCI+aGlkZTwvc3Bhbj4nO1xuICAgICQoXCIuaXctbGlua3NcIikuYXBwZW5kKGZvcm1hdHRlZENvbnRlbnQpO1xuICAgICQoXCIuaXctZm91cnNxdWFyZS12aXNcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbihlKSB7XG4gICAgICBpZiAoZS50YXJnZXQuaW5uZXJIVE1MID09PSBcInNob3dcIikge1xuICAgICAgICAkKFwiLml3LWZvdXJzcXVhcmUtZGF0YVwiKS5zaG93KCk7XG4gICAgICAgIGUudGFyZ2V0LmlubmVySFRNTCA9IFwiaGlkZVwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJChcIi5pdy1mb3Vyc3F1YXJlLWRhdGFcIikuaGlkZSgpO1xuICAgICAgICBlLnRhcmdldC5pbm5lckhUTUwgPSBcInNob3dcIjtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGRpc3BsYXkgRm91cnNxdWFyZSBkYXRhIGluIEluZm9XaW5kb3dcbiAgZnVuY3Rpb24gZm91cnNxdWFyZVN1Y2Nlc3MoZGF0YSkge1xuICAgIHZhciB2ZW51ZSA9IGRhdGEucmVzcG9uc2UudmVudWU7XG4gICAgdmFyIGNvbnRlbnQgPSB7XG4gICAgICBuYW1lOiB2ZW51ZS5uYW1lIHx8IGUubWFwTWFuaXAuaW5mb1dpbmRvd01hcmtlci50aXRsZSxcbiAgICAgIHBob25lOiB2ZW51ZS5jb250YWN0LmZvcm1hdHRlZFBob25lIHx8IFwiTm9uZVwiLFxuICAgICAgY2F0ZWdvcnk6IHZlbnVlLmNhdGVnb3JpZXNbMF0ubmFtZSB8fCBcIk5vbmVcIixcbiAgICAgIGltZ1VybDogdmVudWUuYmVzdFBob3RvLnByZWZpeCArICcxMDB4MTAwJyArIHZlbnVlLmJlc3RQaG90by5zdWZmaXgsXG4gICAgICBhZGRyZXNzOiB2ZW51ZS5sb2NhdGlvbi5mb3JtYXR0ZWRBZGRyZXNzIHx8IFwiTm9uZVwiXG4gICAgfTtcbiAgICB2YXIgZm9ybWF0dGVkQ29udGVudCA9ICc8ZGl2IGNsYXNzPVwiaXctZm91cnNxdWFyZS1kYXRhXCI+JztcbiAgICBmb3JtYXR0ZWRDb250ZW50ICs9ICc8ZGl2IGNsYXNzPVwiaXctaGVhZGVyXCI+JztcbiAgICBmb3JtYXR0ZWRDb250ZW50ICs9ICc8aDMgY2xhc3M9XCJpdy1oZWFkZXItaDNcIj4nICsgY29udGVudC5uYW1lICsgJzwvaDM+PC9kaXY+JztcbiAgICBmb3JtYXR0ZWRDb250ZW50ICs9ICc8ZGl2IGNsYXNzPVwiaXctZGF0YVwiPjxkaXYgY2xhc3M9XCJpdy1waWN0dXJlXCI+PGltZyBzcmM9XCInICsgY29udGVudC5pbWdVcmwgKyAnXCIgJztcbiAgICBmb3JtYXR0ZWRDb250ZW50ICs9ICdhbHQ9XCJQaWN0dXJlIGZyb20gZm91cnNxdWFyZVwiPjwvZGl2Pic7XG4gICAgZm9ybWF0dGVkQ29udGVudCArPSAnPGRpdiBjbGFzcz1cIml3LWRldGFpbFwiPjx1bCBjbGFzcz1cIml3LWRldGFpbC11bFwiPic7XG4gICAgZm9ybWF0dGVkQ29udGVudCArPSAnPGxpIGNsYXNzPVwiaXctZGV0YWlsLWxpXCI+Q2F0ZWdvcnk6ICcgKyBjb250ZW50LmNhdGVnb3J5ICsgJzwvbGk+JztcbiAgICBmb3JtYXR0ZWRDb250ZW50ICs9ICc8bGkgY2xhc3M9XCJpdy1kZXRhaWwtbGlcIj5QaG9uZTogJyArIGNvbnRlbnQucGhvbmUgKyAnPC9saT4nO1xuICAgIGZvcm1hdHRlZENvbnRlbnQgKz0gJzxsaSBjbGFzcz1cIml3LWRldGFpbC1saVwiPkFkZHJlc3M6ICcgKyBjb250ZW50LmFkZHJlc3MgKyAnPC9saT4nO1xuICAgIGZvcm1hdHRlZENvbnRlbnQgKz0gJzwvdWw+PC9kaXY+PC9kaXY+PC9kaXY+JztcbiAgICAkKFwiLml3LW1haW5cIikuYXBwZW5kKGZvcm1hdHRlZENvbnRlbnQpO1xuICB9XG5cbiAgLy8gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gZGlzcGxheSBlcnJvciBtZXNzYWdlIGluIEluZm9XaW5kb3dcbiAgLy8gaWYgZGF0YSBjYW4gbm90IGJlIHJldHJpZXZlZCB2aWEgWWVscCBvciBGb3Vyc3F1YXJlIEFQSXNcbiAgZnVuY3Rpb24gcmVxdWVzdEZhaWxlZChkYXRhKSB7XG4gICAgdmFyIGZvcm1hdHRlZENvbnRlbnQ7XG4gICAgaWYgKGRhdGEgPT09IFwiWWVscFwiKSB7XG4gICAgICBmb3JtYXR0ZWRDb250ZW50ID0gJzxkaXYgY2xhc3M9XCJpdy15ZWxwLWRhdGFcIj4nO1xuICAgIH0gZWxzZSB7XG4gICAgICBmb3JtYXR0ZWRDb250ZW50ID0gJzxkaXYgY2xhc3M9XCJpdy1mb3Vyc3F1YXJlLWRhdGFcIj4nO1xuICAgIH1cbiAgICBmb3JtYXR0ZWRDb250ZW50ICs9ICc8cD5GYWlsZWQgdG8gcmV0cmlldmUgZGF0YSBmcm9tICcgKyBkYXRhICsgJzwvcD48L2Rpdj4nO1xuICAgICQoXCIuaXctbWFpblwiKS5hcHBlbmQoZm9ybWF0dGVkQ29udGVudCk7XG4gIH1cblxufSkobmhvb2RNYXApO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
